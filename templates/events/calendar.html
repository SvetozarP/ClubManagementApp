{# TODO: fix the whole template - part of registered user view #}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Calendar</title>
    <style>
        /* Basic styling for the calendar */
        .calendar-container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            border: 1px solid #ddd;
        }
        .day-header, .day-cell {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .day-header {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .day-cell {
            min-height: 100px;
            position: relative;
        }
        .event {
            background-color: #e0f7fa;
            padding: 3px;
            font-size: 0.9em;
            margin-top: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>

<div class="calendar-container">
    <div class="calendar-header">
        <button onclick="changeMonth(-1)">Previous</button>
        <h2 id="month-year"></h2>
        <button onclick="changeMonth(1)">Next</button>
    </div>

    <div class="calendar-grid">
        <!-- Day headers -->
        <div class="day-header">Sun</div>
        <div class="day-header">Mon</div>
        <div class="day-header">Tue</div>
        <div class="day-header">Wed</div>
        <div class="day-header">Thu</div>
        <div class="day-header">Fri</div>
        <div class="day-header">Sat</div>

        <!-- Days of the month will be populated here -->
        <div id="calendar-days"></div>
    </div>
</div>

<script>
    // Initialize the current date
    let currentDate = new Date();
    const data = {{ data|safe }}; // Embedded booking data

    function renderCalendar() {
        const month = currentDate.getMonth();
        const year = currentDate.getFullYear();

        document.getElementById('month-year').textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });

        // Get the first and last day of the month
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        // Calculate the starting day of the week and total days
        const startDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        // Clear the previous calendar days
        const calendarDays = document.getElementById('calendar-days');
        calendarDays.innerHTML = '';

        // Fill in the blank days for the first week
        for (let i = 0; i < startDayOfWeek; i++) {
            calendarDays.innerHTML += '<div class="day-cell"></div>';
        }

        // Fill in the days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const dayCell = document.createElement('div');
            dayCell.classList.add('day-cell');
            dayCell.setAttribute('data-date', `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`);
            dayCell.innerHTML = `<strong>${day}</strong>`;
            calendarDays.appendChild(dayCell);
        }

        // Place bookings and field bookings on the calendar
        populateEvents(data);
    }

    function populateEvents(data) {
        // Populate the bookings
        data.bookings.forEach(booking => {
            const startDate = new Date(booking.start_date);
            const dateStr = startDate.toISOString().split('T')[0];
            const dayCell = document.querySelector(`.day-cell[data-date="${dateStr}"]`);
            if (dayCell) {
                const eventElement = document.createElement('div');
                eventElement.classList.add('event');
                eventElement.textContent = booking.description;
                dayCell.appendChild(eventElement);
            }
        });

        // Populate the field bookings
        data.field_bookings.forEach(fieldBooking => {
            const dateStr = fieldBooking.date;
            const dayCell = document.querySelector(`.day-cell[data-date="${dateStr}"]`);
            if (dayCell) {
                const eventElement = document.createElement('div');
                eventElement.classList.add('event');
                eventElement.textContent = `From ${fieldBooking.time_from} to ${fieldBooking.time_to}`;
                dayCell.appendChild(eventElement);
            }
        });
    }

    function changeMonth(step) {
        // Change the month by the step (+1 for next, -1 for previous)
        currentDate.setMonth(currentDate.getMonth() + step);
        renderCalendar();
    }

    // Initial render of the calendar
    renderCalendar();
</script>

</body>
</html>